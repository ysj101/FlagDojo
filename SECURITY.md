# セキュリティポリシー

## ⚠️ 意図的な脆弱性について

**FlagDojoは意図的にセキュリティ脆弱性を含む教育用CTFプラットフォームです。**

### 目的

このプラットフォームのチャレンジは**意図的に脆弱に設計**されており、以下の目的があります：

- **教育的**: 一般的なWeb脆弱性について学ぶため
- **隔離されている**: 各チャレンジの脆弱性はそのチャレンジ内に封じ込められている
- **文書化されている**: すべての脆弱性は意図的で学習目的を持つ

### 脆弱なコンポーネント

以下のコンポーネントは**意図的にセキュリティ脆弱性を含んでいます**：

#### ❌ 意図的に脆弱（修正しないでください）

- `challenges/xss-reflected/` - 反射型XSS脆弱性
- `challenges/xss-stored/` - 格納型XSS脆弱性
- `challenges/sqli-basic/` - SQLインジェクション脆弱性
- `challenges/csrf-attack/` - CSRF脆弱性
- `challenges/path-traversal/` - パストラバーサル脆弱性

`challenges/` ディレクトリ内の将来のチャレンジも意図的な脆弱性を含む可能性があります。

#### ✅ セキュアであるべき（問題を報告してください）

- `app/core/` - コアプラットフォームの認証とルーティング
- `app/models.py` - データベースモデル
- `app/extensions.py` - Flask拡張機能
- `app/config.py` - 設定管理
- Flag検証ロジック
- 管理画面
- ユーザー認証システム

## 🔒 安全な使用ガイドライン

### すべきこと ✅

- **ローカルでのみ実行** - 隔離された環境で
- **学習に使用** - 教育目的で
- **VMまたはコンテナで実践** - VM内またはDocker環境で
- **知識を共有** - Webセキュリティについて他の人と共有
- **自由に実験** - それを目的に設計されています！

### してはいけないこと ❌

- **公開インターネットにデプロイしない** - 実際の脆弱性が露出します
- **本番データベースに接続しない** - 隔離されたSQLiteデータベースを使用
- **機密データを保存しない** - これは学習環境のみです
- **企業ネットワークで使用しない** - ローカルマシンに隔離してください
- **脆弱性スキャナーに提出しない** - 脆弱性は意図的です

## 🌐 ネットワーク隔離の推奨事項

FlagDojoを実行する際は、以下のセキュリティ対策を検討してください：

### 最小限のセキュリティ（ローカル開発）
```bash
# localhostでのみ実行（デフォルト）
uv run python run.py
# アクセス: http://localhost:5000
```

### 推奨セキュリティ（Docker）
```bash
# Dockerが環境を隔離
docker-compose -f docker/docker-compose.yml up -d
# アクセス: http://localhost:5000
```

### 最大セキュリティ（VMまたは隔離ネットワーク）
- 専用VM（VirtualBox、VMware等）で実行
- 別のネットワークセグメントを使用
- 本番システムへの接続なし
- テスト前にスナップショットを取得

## 🐛 セキュリティ問題の報告

### 意図的な脆弱性（チャレンジ）の場合

**意図的なチャレンジの脆弱性を報告しないでください** - それは設計通りです！チャレンジを解決できた場合、それは意図された動作です。

### 意図しないプラットフォーム脆弱性の場合

コアプラットフォーム（チャレンジではなく）で**実際のセキュリティ問題**を発見した場合は、責任を持って報告してください：

1. **メール**: security@example.com（あなたのメールに置き換えてください）
2. **件名**: [SECURITY] FlagDojo - 簡単な説明
3. **含める内容**:
   - 脆弱性の説明
   - 再現手順
   - 潜在的な影響
   - 提案される修正（あれば）

**してはいけないこと**:
- セキュリティ脆弱性について公開GitHubイシューを開く
- 対処する時間を与える前に脆弱性を公開する
- 脆弱性を悪意を持って悪用する

### 対応タイムライン

- **初回応答**: 48時間以内
- **ステータス更新**: 1週間以内
- **修正タイムライン**: 深刻度による（重大な問題は1週間以内）

## 🔐 ユーザーのためのセキュリティベストプラクティス

FlagDojoを使って学習する際：

1. **脆弱性を理解してから**エクスプロイトする
2. **ヒントを読んで**意図された教訓を学ぶ
3. **実際のシナリオで責任ある開示を実践**する
4. **許可なくこれらの技術を使用しない**システムに対して
5. **防御技術を適用**自分のプロジェクトに

## 🛡️ セキュリティアーキテクチャ

### 隔離レイヤー

FlagDojoは脆弱性を隔離するために複数のレイヤーを実装しています：

```
┌─────────────────────────────────────────┐
│  コアプラットフォーム（セキュア）        │
│  - 強力な認証                            │
│  - セキュアなFlag検証                    │
│  - 保護された管理ルート                  │
├─────────────────────────────────────────┤
│  チャレンジ隔離                          │
│  - 別々のブループリント                  │
│  - 隔離されたセッション                  │
│  - プレフィックス付きデータベーステーブル│
├─────────────────────────────────────────┤
│  個別チャレンジ（脆弱）                  │
│  - 意図的なXSS、SQLi等                   │
│  - コアプラットフォームにアクセス不可    │
│  - 他のチャレンジを変更不可              │
└─────────────────────────────────────────┘
```

### セキュリティ境界

- **チャレンジができないこと**:
  - コアプラットフォームのセッションにアクセス
  - ユーザーアカウントやFlagを変更
  - 他のチャレンジに影響を与える
  - ブループリント名前空間から脱出

- **コアプラットフォームの必須事項**:
  - すべてのFlagを安全に検証
  - 管理ルートを保護
  - ユーザー認証を保護
  - チャレンジの脱出を防ぐ

## 📋 貢献者向けセキュリティチェックリスト

新しいチャレンジを追加する場合：

- [ ] `challenges/` ディレクトリに配置
- [ ] 一意のブループリント名を使用
- [ ] データベーステーブルにプレフィックスを付ける（例：`xss_comments`）
- [ ] コメントで脆弱性を文書化
- [ ] 学習者向けに明確なヒントを追加
- [ ] コアプラットフォームに影響しないことをテスト
- [ ] `# 意図的な脆弱性` コメントで脆弱なコードをマーク

コアプラットフォームを変更する場合：

- [ ] 認証が維持されていることを確認
- [ ] すべてのユーザー入力を検証
- [ ] パラメータ化されたクエリを使用
- [ ] CSRF保護を実装
- [ ] 出力を適切にエスケープ
- [ ] OWASP Top 10に対してテスト
- [ ] マージ前にメンテナーによるレビュー

## 🔍 脆弱性カテゴリ

### 期待される（意図的な）脆弱性

これらの脆弱性は**学習目標**です：

- **A03:2021 – インジェクション**: SQLインジェクションチャレンジ
- **A07:2021 – XSS**: 反射型および格納型XSSチャレンジ
- **A01:2021 – 壊れたアクセス制御**: パストラバーサルチャレンジ
- **A05:2021 – セキュリティ設定ミス**: 各種チャレンジの設定ミス
- **A08:2021 – ソフトウェアとデータの整合性の失敗**: CSRFチャレンジ

### 受け入れられない（報告してください）脆弱性

**コアプラットフォーム**でこれらを見つけた場合は報告してください：

- メインログインシステムの認証バイパス
- Flag検証のバイパス
- 管理者権限昇格
- コアプラットフォームのRCE（リモートコード実行）
- チャレンジスコープを超えたデータベース侵害
- コアプラットフォームのセッションハイジャック
- 実際の認証情報の情報漏洩

## 📚 追加リソース

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE - 共通脆弱性タイプ一覧](https://cwe.mitre.org/)
- [OWASP テストガイド](https://owasp.org/www-project-web-security-testing-guide/)
- [責任ある開示ガイドライン](https://ja.wikipedia.org/wiki/責任ある情報開示)

## 📄 法的免責事項

**FlagDojoは教育目的のみで「現状のまま」提供されています。**

- メンテナーはこのソフトウェアの誤用に対して**責任を負いません**
- 明示的な許可なくシステムにこれらの技術を使用**しないでください**
- コンピュータシステムへの不正アクセスは**違法**です
- このソフトウェアは**学習と許可されたテストのみ**を目的としています
- ユーザーは自分の行動に対してすべての責任を負います

## 🔄 バージョン履歴

- **v0.1.0**（初回リリース）
  - 5つの意図的な脆弱性チャレンジ
  - セキュアなコアプラットフォーム
  - プラグインアーキテクチャ

---

**覚えておいてください**: 大きな力には大きな責任が伴います。倫理的に知識を使用してください！ 🥋

最終更新: 2026-01-17
